<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<style>
	#status {
		background-color: blue;
		font-size: 4;
		font-weight: bold;
		color: white;
		line-height: 140%;
	}

	#warning {
		color: red;
	}

	label {
		display: inline-block;
		float: left;
		clear: left;
		width: 60px;
		text-align: right;
	}

	input {
		display: inline-block;
		float: left;
	}
</style>

<head>
	<title>Rover</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
	<!-- <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script> -->
	<script type="text/javascript">

		const userAction = async (cmd) => {
			url = 'https://rover-controller.azurewebsites.net/api/' + cmd
			const response = await fetch(url);
			// const myJson = await response.json(); //extract JSON from the http response
			// do something with myJson
		}


		document.onkeydown = function (event) {
			switch (event.keyCode) {
				case 38: // up key
					userAction('forward');
					// send_command(cmds.Forward);
					break;
				case 40: // down key
					// send_command(cmds.Backward)
					userAction('backward');
					break;
				case 37: // left key
					// send_command(cmds.RightForward);
					userAction('rightforward');
					break;
				case 39: // right key
					// send_command(cmds.LeftForward);
					userAction('leftforward');
					break;
				case 32:
					// send_command(cmds.Stop);
					userAction('stop');
					break;
				case 122: // z or Z key
				case 90:
					userAction('sharpleft');
					break;
				case 120: // x or X key
				case 88:
					userAction('sharpright');
					break;
				case 115: // s or S key
				case 83:
					userAction('shutdown');
					break;
			}
		};

	</script>

</head>

<body>
	<h1>.NET Core Rover with Azure SignalR</h1>

	<script type="text/javascript">

	</script>
	<script>
		var connected_flag = 0
		var mqtt;
		var reconnectTimeout = 2000;
		var host;
		var port = 9001;
		var topic = "/rover/motor"

	</script>


	<br>

	<img src="dotnet-iot.jpg">

	<br>
	<br>

	<hr>
	<h2>Rover Control Keys</h2>

	<table cellpadding="30">
		<tr>
			<td width="40%">
				<table cellpadding="4">
					<tr>
						<th>Key</th>
						<th>Direction</th>
					</tr>
					<tr>
						<td id="warning"><b>Space</b></td>
						<td id="warning"><b>Stop</b></td>
					</tr>
					<tr>
						<td>&larr;</td>
						<td>Left</td>
					</tr>
					<tr>
						<td>&rarr;</td>
						<td>Right</td>
					</tr>
					<tr>
						<td>&uarr;</td>
						<td>Forward</td>
					</tr>
					<tr>
						<td>&darr;</td>
						<td>Backward</td>
					</tr>
					<tr>
						<td>z</td>
						<td>Circle left</td>
					</tr>
					<tr>
						<td>x</td>
						<td>Circle right</td>
					</tr>
				</table>
			</td>
			<td><img src="rover.jpg" alt=".NET Core Rover" width="350"></td>
		</tr>
	</table>

</body>

</html>